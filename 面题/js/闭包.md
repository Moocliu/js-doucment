# 闭包

## 说书什么是闭包（你理解的闭包）

- 个人理解：

在 闭包的形成我们得先了解一下 js 作用域。可分为全局作用域、和局部作用域，（而函数就是 js 中常见的一中局部作用域），由此可知道 函数中的一些参数不能被外部的获取或者是使用，那怎么实现获取到函数的定义的参数属性值，这时候就引出了一个概念“闭包”，

##  

- 闭包的特点：

　　1. 作为一个函数变量的一个引用，当函数返回时，其处于激活状态。

　　2. 一个闭包就是当一个函数返回时，一个没有释放资源的栈区。

　　简单的说，Javascript允许使用内部函数---即函数定义和函数表达式位于另一个函数的函数体内。而且，这些内部函数可以访问它们所在的外部函数中声明的所有局部变量、参数和声明的其他内部函数。当其中一个这样的内部函数在包含它们的外部函数之外被调用时，就会形成闭包。



 链接：https://juejin.im/post/5c7f5923f265da2dd218f195来源： 

####什么是闭包？优缺点分别是什么？

1.首先 ，在函数外部无法函数内部的变量。 2.为了解决上面的问题，则引入闭包。简单来说为了能够访问函数 A 内部的变量值，需要在函数 A 中定义一个其他函数 B，并且将 B 返回给外部变量，那么外部变量就可以通过 B 来访问到函数 A 中的变量了，这就是闭包。 3.闭包方便访问函数内部的变量，但是同时也会导致原来函数 A 中的变量无法及时销毁，导致内存占用过高，并且如果没有及时销毁的话，也存在内存泄漏问题

应用场景：

通常 ： 1.高阶函数 使用闭包+改写函数的 toString() （调用函数默认会自动运行 toStrig）

2.封装私有变量

3.模仿块级作用域（es5 中没有块级作用域）

4.实现 js 模块

## 闭包为什么会造成内存泄漏？ 和怎么解决内存泄漏

```js
function A(){
  var count = 0;
  function B(){
    count ++;
    console.log(count);
  }
  return B;
}
var C = A();
C();// 1
C();// 2
C();// 3

在A函数执行的时候，我们发现执行过程中，遇到B函数，好了它开始调用栈执行，执行完毕后，控制权回归A函数，然后把B函数return出去了 。 B函数中保持count变量的引用，你就把它return出去了?
  
B函数被推出去到外面的时间： B赋值给了C ，好了C需要count 变量的支持，count就不能厉害内存(也就不能被垃圾回收)；A 函数执行完了我也就该离开了(函数执行完毕后，函数内部的变量会被回收掉)，不好意思，外面的执行着的函数还有对你的引用，那不好意思你就别退栈了，并不允许你离开调用栈，因为要保留count变量环境

```





总结：闭包并不会引起内存泄漏，只是由于 IE9 之前版本对 JScript 对象和 COM 对象的使用不同的垃圾收集，从而导致内存无法进行回收

### 使用闭包的注意点

1.由于闭包会使得函数中的变量都被保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页性能问题， 在 IE 中可能导致内存泄漏，解决方法：在退出函数之前吗，将不使用的局部变量全部删除

2.闭包会在父函数外部，改变父函数的内部变量的值，所以如果你把父函数当作对象使用，把闭包当作公用方法，，把内部变量当作它的私有属性，注意，不要随便改变父函数内部的值

### 垃圾回收机制

最常用的是”引用计数“ 如果一个值的引用次数为 0 ，就表示这个值不再用到了，会释放这个值，但是有些值，不再用，但是引用次数不为 0 次，就无法释放这块内存，从而导致内存泄漏，还是需要自己手动清除





内存泄漏参考文档：

http://www.ruanyifeng.com/blog/2017/04/memory-leak.html

数据结构闭包：

https://juejin.im/post/5b65a7fdf265da0fa00a3999